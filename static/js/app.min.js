!function(){"use strict";window.PetaTube={Model:{},Collection:{},View:{}},jQuery(function(){var a,b,c,d,e;return a=window.PetaTube,e=new a.Collection.Videos,new a.View.Search({videos:e}),new a.View.Video({videos:e}),c=window.location.search.match(/\?(https?.+)/),c?(d=c[1],e.fetchByUrl(d)):(b=new a.Collection.HotPages,new a.View.HotPages({collection:b}),b.fetch()),$(".bookmarklet").powerTip({placement:"s"})})}.call(this),function(){"use strict";PetaTube.Model.HotPage=Backbone.Model.extend({petaURL:function(){var a;return a=this.get("url"),"/?"+a},thumbnailImagePath:function(){var a;return a=this.get("thumbnailVideoId"),"http://i.ytimg.com/vi/"+a+"/default.jpg"}})}.call(this),function(){"use strict";PetaTube.Model.Video=Backbone.Model.extend({urlRoot:"/videos/"})}.call(this),function(){"use strict";PetaTube.Collection.Pages=Backbone.Collection.extend({model:PetaTube.Model.HotPage,fetch:function(){var a=this;return $.ajax({url:"/popular",dataType:"json",data:{}}).done(function(b){return a.reset(b)})}})}.call(this),function(){"use strict";PetaTube.Collection.Videos=Backbone.Collection.extend({currentIndex:0,model:PetaTube.Model.Video,fetchByUrl:function(a){var b=this;return $.ajax({url:"/videos/",dataType:"json",data:{url:a}}).done(function(a){return b.currentIndex=0,b.title=a.title,b.url=a.url,b.reset(a.video_ids),b.trigger("change:title")})},current:function(){return this.at(this.currentIndex)},next:function(){return++this.currentIndex,this.currentIndex>=this.length?this.currentIndex=0:void 0},prev:function(){return--this.currentIndex,this.currentIndex<0?this.currentIndex=this.length-1:void 0},skip:function(){var a;return a=this.current().id,this.next(),this.remove(a),0!==this.currentIndex?this.prev():void 0},shufflePlay:function(){return this.currentIndex=0,this.reset(this.shuffle())}})}.call(this),function(){"use strict";PetaTube.View.HotPages=Backbone.View.extend({el:"#hot",initialize:function(){return this.collection.on("reset",this.draw,this)},draw:function(a){var b;return b=$("<ul>"),a.each(function(a){var c,d;return d=$("#tmpl-hot-pages").html(),c=_.template(d,{title:a.get("title"),petaURL:a.petaURL(),videoCount:a.get("videoCount"),thumbnailImagePath:a.thumbnailImagePath()}),b.append(c)}),this.$el.append(b),this.$el.fadeIn()}})}.call(this),function(){"use strict";PetaTube.View.Search=Backbone.View.extend({el:"#input-url",initialize:function(a){return this.videos=a.videos,this.videos.on("change:title",this.showTitle,this)},events:{"submit form":"search"},search:function(){var a;return a=this.$el.find("input[name='url']").val(),a&&(window.location.search=a),!1},showTitle:function(){return this.$el.find("#play-url").empty().append($("<span>").text("by ")).append($("<a>").attr("href",this.videos.url).text(this.videos.title)).append($('<span class="video_count">').text("("+this.videos.length+"videos)"))}})}.call(this),function(){"use strict";PetaTube.View.Video=Backbone.View.extend({player:null,el:"#play-video",initialize:function(a){return this.videos=a.videos,this.videos.on("reset",this.play,this)},events:{"click #prev-button":"prev","click #next-button":"next","click #shuffle-button":"shuffle"},next:function(){return this.videos.next(),this.play()},prev:function(){return this.videos.prev(),this.play()},skip:function(){return this.videos.skip(),this.play()},shuffle:function(){return this.videos.shufflePlay()},play:function(){var a,b,c,d=this;return c=this.videos.current(),c.get("title")?(this.$el.find("#video-info").text(c.get("title")),$("title").text(c.get("title")+"(PetaTube)")):c.fetch({success:function(){return d.$el.find("#video-info").text(c.get("title")),$("title").text(""+c.get("title")+"(PetaTube)")}}),this.loadPlayer(),b=$("#tmpl-button").html(),a=_.template(b,{current:this.videos.currentIndex+1,total:this.videos.length}),this.$el.find("#video-panel").html(a),this.$el.show()},loadPlayer:function(){var a,b,c,d=this;return c=this.videos.current(),this.player?this.player.loadVideoById(c.id):(b=document.createElement("script"),b.src="//www.youtube.com/iframe_api",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(b,a),window.onYouTubeIframeAPIReady=function(){return d.player=new YT.Player("video",{height:"425",width:"760",videoId:c.id,events:{onReady:function(){},onStateChange:function(a){var b;return b=a.data,b===YT.PlayerState.ENDED?d.next():void 0},onError:function(){return d.skip()}}})})}})}.call(this),function(){"use strict"}.call(this);